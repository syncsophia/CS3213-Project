<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
"http://www.w3.org/TR/html4/strict.dtd">

<head>
    
	<link href="css/dragdropstyle.css" rel="stylesheet">
    <link rel="stylesheet" href="css/runnable.css" />
	<!-- for menu bar -->
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
	  <!-- Source our javascript file with the jQUERY code -->
		
	<script type="text/javascript" src="js/draggabilly.pkgd.min.js"></script>
	<script type="text/javascript" src="js/dragdrop.js"></script>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/init.js"></script>
	<script type="text/javascript" src="js/menubar.js"></script>
	<script type="text/javascript">
	
	// global variable to get access to all possible commands
	var commands =  {"move": new MoveCommand(1), 
					"jump": new JumpCommand(1), 
					"xPos": new SetXPosCommand(1), 
					"yPos": new SetYPosCommand(1),
					"origin": new SetToOriginCommand()};
	
	$(function() {
		//console.log("Document ready");
		
		var dragDropElementTable = document.getElementById('allItems');
		
		for (key in commands)
		{
			var li_Element = document.createElement("li");
			li_Element.appendChild(document.createTextNode(commands[key].getText()));
			li_Element.setAttribute("id", "li_" + key);
			li_Element.setAttribute("class", "code");
			dragDropElementTable.appendChild(li_Element);
		};

		var txt_E = document.createElement("textarea");
		txt_E.setAttribute("maxLength", '4');
		txt_E.setAttribute("cols", '5');
		txt_E.setAttribute("rows", '1');
		txt_E.setAttribute("defaultValue", '2');
		txt_E.setAttribute("id", "txt_Move");

	});
	</script>
</head>

<body>
<div id="header" class="navigation">
	<!-- do menu here -->
	<ul class="nav">
		<li>
		  <a href="#">Home</a>
		  	<ul>
		  		<li><a href="#">Login/Logout</a></li>
		  		<li><a href="#">Save</a></li>
		  		<li><a href="#">Load</a></li>
		  	</ul>
		</li>
		<li>
		  	<a href="#">Change Character</a>
		  		<ul>
		  			<li>
		  				<input type="image" title="snail1"
						src="img/small_snail_1.png" onclick="ChangeCharacterCostume('img/snail_1.png')">
		  			</li>
		  			<li>
		  				<input type="image" title="snail2" 
						src="img/small_snail_2.png" onclick="ChangeCharacterCostume('img/snail_2.png')">
		  			</li>
		  			<li>
		  				<input type="image" title="snail3" 
						src="img/small_snail_3.png" onclick="ChangeCharacterCostume('img/snail_3.png')">
		  			</li>
		  		</ul>
		</li>
		<li>
		  	<a href="#">Change Background</a>
		  		<ul>
		  			<li>
		  				<input type="image" title="back1" 
						src="img/code.jpg" onclick="ChangeBackground('img/code.jpg')">
		  			</li>
		  		</ul>
		</li>
	</ul>
</div>
<div id="dhtmlgoodies_dragDropContainer">
	<div id="dhtmlgoodies_listOfItems">
		<div title="This is the list of code-command templates you can use.">
			<p>Elements</p>
		<ul id="allItems"></ul>
		</div>
	</div>
	<div id="dhtmlgoodies_mainContainer">
		<!-- ONE <UL> for each "room" -->
		<div title="This is the Code area, where your chosen templates are displayed.">
			<p>Code</p>
			<ul id="box1" class='class_code'>

			</ul>
		</div>
	</div>


	<div id="editorContainer" title="This is the editor. Please click the play-Button below to let the character perform your code.">
		<!-- ONE <UL> for each "room" -->
		<div class="human">
		<img src="img/human.png" class='character_human' id="character_human">
		</div>
	</div>
</div>
<div id="footer">
	<input type="image" title="Clear All" src="img/recycle.png" onclick="ClearEditor()" value="Clear">
	<input type="image" title="Stop" src="img/stop.png" onclick="StopEditor()" value="Stop">
	<input type="image" title="Play" src="img/play.png" onclick="PlayEditor()" value="Play">
</div>
<ul id="dragContent">

</ul>
<div id="dragDropIndicator"><img src="img/insert.gif"></div>

<script type="text/javascript" src="js/move.js"></script>
<script type="text/javascript">
	
	var characterElement = document.getElementById("character_human");
	
	var listOfCurrentCommands = []; 
		
	var draggie = new Draggabilly( characterElement, {
		containment: "#editorContainer"
	});
	
	/*
	* gets the right command for the object
	*/
	var newCommand = function(id) {
		var commandId = id.substring(3);
		return commands[commandId];
	}
	
	var PlayEditor = function() {
		console.log("[dragdrop.html]: PlayEditor");
		$('.class_code').each(function() {
    		$(this).find("li").each(function() {
    			var current = $(this);
    			if(current.children().size() > 0) {
    				return true;
    			}
				//create command class and perform commands after loop
				var command = new newCommand(current.attr('id'));
				listOfCurrentCommands.push(command);
    		});
			
			listOfCurrentCommands.push("origin");
			listOfCurrentCommands.forEach(function(entry) {
				entry.execute();
			});
			//then delete the list: otherwise it will be summed up?
			listOfCurrentCommands = [];
    	});
	}
	
	var StopEditor = function() {
		//TODO
		listOfCurrentCommands = [];
		new ChangeCharacterCostume("img/snail_1.png");
	};
	
	/* clears the code panel
	*/
	var ClearEditor = function() {
		$('.class_code').each(function() {
    		$(this).find("li").remove();
    	});
	}
	
	/* 
	* function to change to background of the editor panel.
	*/
	var ChangeBackground = function(url) {
		var editorDiv = document.getElementById( 'editorContainer' );
		editorDiv.style.backgroundImage = "url("+ url + ")";
	}
	
	/* 
	* function to change to costume of the character.
	*/
	var ChangeCharacterCostume = function(url) {
		characterElement.src = url;
	}
</script>
</body>

</html>
